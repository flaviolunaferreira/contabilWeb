<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASA 360º Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 bg-white border-r border-slate-200 flex flex-col p-6 hidden md:flex shrink-0 z-20">
        <div class="flex items-center gap-3 mb-10 px-2">
            <div class="w-10 h-10 bg-[#006739] rounded-xl flex items-center justify-center text-white shadow-lg shadow-emerald-200">
                <i class="fas fa-university text-xl"></i>
            </div>
            <div>
                <h1 class="text-lg font-black tracking-tight leading-none text-[#006739]">BASA</h1>
                <p class="text-[10px] text-[#FDB913] font-bold uppercase tracking-widest">360º Ultimate</p>
            </div>
        </div>

        <nav class="space-y-2 flex-1">
            <div onclick="App.navigate('dashboard')" id="nav-dashboard" class="nav-item active p-4 rounded-2xl flex items-center gap-3 font-bold text-sm text-slate-500">
                <i class="fas fa-chart-pie w-5"></i> Dashboard
            </div>
            <div onclick="App.navigate('lancamentos')" id="nav-lancamentos" class="nav-item p-4 rounded-2xl flex items-center gap-3 font-bold text-sm text-slate-500">
                <i class="fas fa-list-ul w-5"></i> Lançamentos
            </div>
            <div onclick="App.navigate('cartoes')" id="nav-cartoes" class="nav-item p-4 rounded-2xl flex items-center gap-3 font-bold text-sm text-slate-500">
                <i class="fas fa-credit-card w-5"></i> Meus Cartões
            </div>
            <div onclick="App.navigate('analise')" id="nav-analise" class="nav-item p-4 rounded-2xl flex items-center gap-3 font-bold text-sm text-slate-500">
                <i class="fas fa-chart-line w-5"></i> Análise 360º
            </div>
            <div onclick="App.navigate('conselheiro')" id="nav-conselheiro" class="nav-item p-4 rounded-2xl flex items-center gap-3 font-bold text-sm text-slate-500">
                <i class="fas fa-brain w-5"></i> Conselheiro
            </div>
            <div onclick="App.navigate('config')" id="nav-config" class="nav-item p-4 rounded-2xl flex items-center gap-3 font-bold text-sm text-slate-500">
                <i class="fas fa-cog w-5"></i> Ajustes & Backup
            </div>
        </nav>

        <div class="bg-slate-900 rounded-2xl p-4 text-white mt-auto">
            <p class="text-[10px] font-bold text-slate-400 uppercase">Saldo Livre</p>
            <h3 id="sidebar-balance" class="text-xl font-black mt-1">R$ 0,00</h3>
        </div>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden relative">
        
        <header class="min-h-20 bg-white/80 backdrop-blur-md border-b border-slate-200 flex flex-wrap items-center justify-between px-4 md:px-8 py-2 gap-2 shrink-0 z-10">
            <div class="flex items-center gap-2 md:gap-4 overflow-x-auto w-full md:w-auto pb-2 md:pb-0">
                <button onclick="App.changeDate(-1)" class="w-8 h-8 rounded-lg hover:bg-slate-100 flex items-center justify-center transition shrink-0"><i class="fas fa-chevron-left text-slate-400"></i></button>
                <h2 id="header-date" class="text-lg font-extrabold text-slate-800 min-w-[140px] md:min-w-[160px] text-center capitalize truncate">--</h2>
                <button onclick="App.changeDate(1)" class="w-8 h-8 rounded-lg hover:bg-slate-100 flex items-center justify-center transition shrink-0"><i class="fas fa-chevron-right text-slate-400"></i></button>
                <div class="ml-2 md:ml-4 flex items-center gap-2 shrink-0">
                    <i class="fas fa-filter text-slate-400 text-sm"></i>
                    <select id="category-filter" onchange="App.render()" class="max-w-[120px] md:max-w-none px-2 md:px-3 py-2 rounded-lg border border-slate-200 text-sm font-medium text-slate-600 bg-white focus:outline-none focus:border-[#006739] hover:bg-slate-50 transition">
                        <option value="">Todas Categorias</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-2 w-full md:w-auto justify-end">
                <button onclick="Modal.open('card')" class="flex-1 md:flex-none justify-center bg-white border border-slate-200 hover:bg-slate-50 text-slate-600 px-4 py-2.5 rounded-xl font-bold text-sm transition flex items-center gap-2">
                    <i class="fas fa-credit-card"></i> <span class="hidden sm:inline">Cartão</span>
                </button>
                <button onclick="Modal.open('transaction')" class="flex-1 md:flex-none justify-center bg-[#006739] hover:bg-[#004d2c] text-white px-5 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-emerald-200 transition flex items-center gap-2">
                    <i class="fas fa-plus"></i> Novo
                </button>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-4 md:p-8 custom-scroll relative">
            
            <div id="view-dashboard" class="space-y-8 animate-fade">
                <section class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 md:gap-6">
                    <div class="glass-card p-6 border-l-4 border-emerald-500">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Receitas (Mês)</p>
                        <h3 id="kpi-income" class="text-3xl font-black text-emerald-600 mt-2">R$ 0,00</h3>
                        <div class="mt-3 text-xs text-slate-500 flex justify-between font-bold">
                            <span>Real: <b id="kpi-inc-real" class="text-emerald-600 text-sm">0</b></span>
                            <span>Pend: <b id="kpi-inc-pend" class="text-amber-500 text-sm">0</b></span>
                        </div>
                    </div>
                    <div class="glass-card p-6 border-l-4 border-rose-500">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Despesas (Mês)</p>
                        <h3 id="kpi-expense" class="text-3xl font-black text-rose-600 mt-2">R$ 0,00</h3>
                        <div class="mt-3 text-xs text-slate-500 flex justify-between font-bold">
                            <span>Real: <b id="kpi-exp-real" class="text-rose-600 text-sm">0</b></span>
                            <span>Pend: <b id="kpi-exp-pend" class="text-amber-500 text-sm">0</b></span>
                        </div>
                    </div>
                    <div class="glass-card p-6 border-l-4 border-[#006739] bg-gradient-to-br from-emerald-50 to-yellow-50">
                        <p class="text-[10px] font-bold text-[#006739] uppercase tracking-widest">Saldo Acumulado</p>
                        <h3 id="kpi-projected" class="text-3xl font-black text-[#004d2c] mt-2">R$ 0,00</h3>
                        <p class="text-[10px] text-[#006739] font-bold mt-2">Projeção até fim do mês</p>
                    </div>
                    <div class="glass-card p-6 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border-none relative overflow-hidden shadow-2xl">
                        <div class="relative z-10">
                            <p class="text-[10px] font-bold text-slate-300 uppercase tracking-widest">Saldo Livre</p>
                            <h3 id="kpi-free-balance" class="text-4xl font-black mt-2 text-emerald-400">R$ 0,00</h3>
                            <div class="mt-3 text-[11px] font-bold text-slate-200 border-t border-white/20 pt-3">
                                <div class="flex justify-between"><span>Caixa Hoje:</span> <span id="kpi-current-cash" class="text-white text-sm">R$ 0,00</span></div>
                                <div class="flex justify-between text-rose-300 mt-1.5"><span>Reserva (Dia 1-5):</span> <span id="kpi-reserve" class="text-sm">- R$ 0,00</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="glass-card p-6 lg:col-span-2">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-black text-slate-900 text-lg">Fluxo Financeiro (Efetivo)</h3>
                            <span class="text-xs font-bold text-[#006739] uppercase tracking-wide bg-emerald-50 px-3 py-1.5 rounded-lg">Visão Gráfica</span>
                        </div>
                        <div class="h-64 relative w-full">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                    <div class="glass-card p-6 flex flex-col lg:row-span-2 h-[500px] lg:h-[800px]">
                        <h3 class="font-black text-slate-900 mb-4 shrink-0 text-lg">Próximos Vencimentos</h3>
                        <div id="dashboard-agenda" class="flex-1 overflow-y-auto custom-scroll pr-2 space-y-3">
                        </div>
                    </div>
                    <div class="glass-card p-6 lg:col-span-2">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h3 class="font-black text-slate-900 text-lg">Análise por Categoria</h3>
                                <p class="text-xs text-amber-600 font-bold uppercase tracking-wide">Distribuição de receitas e despesas</p>
                            </div>
                            <span class="text-xs font-bold text-purple-600 uppercase tracking-wide bg-purple-50 px-3 py-1.5 rounded-lg">Por Categoria</span>
                        </div>
                        <div class="h-64 relative w-full">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>

            <!-- Nova Seção de Agrupamento -->
            <div class="glass-card p-6 mt-6">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <div>
                        <h3 id="tituloResumo" class="font-black text-slate-900 text-xl">Resumo por Descrição</h3>
                        <p class="text-xs text-amber-600 font-bold uppercase tracking-wide">Visão detalhada do período</p>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <div class="flex flex-col">
                            <label class="text-[10px] font-bold text-slate-400 uppercase mb-1">Prever Saldo para o dia</label>
                            <input type="date" id="preverSaldoData" class="bg-slate-50 border border-slate-200 rounded-lg p-2 text-xs font-bold text-slate-600 focus:outline-none focus:border-[#006739]" onchange="App.render()">
                        </div>
                        
                        <div class="flex flex-col">
                            <label class="text-[10px] font-bold text-slate-400 uppercase mb-1">Agrupar Demonstrativo Por</label>
                            <select id="agrupamentoPeriodo" class="bg-slate-50 border border-slate-200 rounded-lg p-2 text-xs font-bold text-slate-600 focus:outline-none focus:border-[#006739]" onchange="App.render()">
                                <option value="descricao">Por Descrição</option>
                                <option value="dia" selected>Por Dia</option>
                                <option value="semana">Por Semana</option>
                                <option value="mes">Por Mês</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm min-w-[600px]">
                        <thead class="bg-gradient-to-r from-amber-600 to-orange-600 border-b-4 border-amber-500 text-white">
                            <tr>
                                <th id="headerPeriodo" class="p-4 font-black rounded-tl-xl uppercase text-xs tracking-wider">Descrição</th>
                                <th class="p-4 font-black text-center uppercase text-xs tracking-wider">Qtd</th>
                                <th class="p-4 font-black text-right uppercase text-xs tracking-wider">Entradas</th>
                                <th class="p-4 font-black text-right uppercase text-xs tracking-wider">Saídas</th>
                                <th class="p-4 font-black text-right uppercase text-xs tracking-wider">Resultado</th>
                                <th class="p-4 font-black text-right rounded-tr-xl uppercase text-xs tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-summary-table"></tbody>
                    </table>
                </div>
            </div>
            </div>

            <div id="view-cartoes" class="hidden space-y-8">
                <div class="glass-card p-6 border-l-4 border-slate-800 bg-gradient-to-r from-slate-50 to-slate-100 flex justify-between items-center">
                    <div>
                        <h2 class="text-xl font-black text-slate-900">Resumo de Faturas</h2>
                        <p class="text-xs text-slate-600 font-bold uppercase mt-1">Total a pagar no mês selecionado</p>
                    </div>
                    <h3 id="cards-total-month" class="text-4xl font-black text-slate-900">R$ 0,00</h3>
                </div>
                <div id="cards-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <div id="view-analise" class="hidden space-y-6">
                <!-- Conteúdo Análise será injetado pelo JS -->
                <div class="glass-card p-8 text-center" id="analise-container">
                    <i class="fas fa-spinner fa-spin text-3xl text-emerald-600"></i>
                </div>
            </div>

            <div id="view-conselheiro" class="hidden space-y-6">
                <!-- Conteúdo Conselheiro será injetado pelo JS -->
                 <div id="conselheiro-container" class="grid grid-cols-1 gap-6"></div>
            </div>

            <div id="view-lancamentos" class="hidden space-y-6">
                <div class="flex flex-col md:flex-row justify-between md:items-end gap-4">
                    <h2 class="text-2xl font-black text-slate-800">Extrato Detalhado</h2>
                    <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                         <select id="agrupamentoRelatorio" onchange="App.render()" class="w-full sm:w-auto px-4 py-2 rounded-xl border border-slate-200 text-sm focus:outline-none focus:border-[#006739]">
                            <option value="none">Sem Agrupamento</option>
                            <option value="dia">Por Dia</option>
                            <option value="semana">Por Semana</option>
                        </select>
                        <input type="text" id="search-input" onkeyup="App.renderList()" placeholder="Buscar..." class="w-full sm:w-auto px-4 py-2 rounded-xl border border-slate-200 text-sm focus:outline-none focus:border-[#006739]">
                    </div>
                </div>
                <div class="glass-card overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm min-w-[800px]">
                            <thead class="bg-gradient-to-r from-slate-700 to-slate-800 border-b-4 border-[#006739] text-white">
                                <tr>
                                    <th class="p-4 font-black uppercase text-xs tracking-wider">Data Efetiva</th>
                                    <th class="p-4 font-black uppercase text-xs tracking-wider">Descrição</th>
                                    <th class="p-4 font-black uppercase text-xs tracking-wider">Categoria</th>
                                    <th class="p-4 font-black uppercase text-xs tracking-wider">Método</th>
                                    <th class="p-4 font-black uppercase text-xs tracking-wider">Status</th>
                                    <th class="p-4 font-black uppercase text-xs tracking-wider text-right">Valor</th>
                                    <th class="p-4 font-black uppercase text-xs tracking-wider text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-config" class="hidden space-y-8">
                <h2 class="text-2xl font-black text-slate-800">Manutenção</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="glass-card p-8">
                        <h3 class="font-bold text-lg mb-2">Dados</h3>
                        <div class="space-y-3">
                            <button onclick="DataMgr.export()" class="w-full p-4 bg-slate-100 hover:bg-slate-200 rounded-xl font-bold text-slate-700 flex justify-between">
                                <span><i class="fas fa-download mr-2"></i> Baixar JSON</span>
                            </button>
                            <label class="w-full p-4 bg-slate-100 hover:bg-slate-200 rounded-xl font-bold text-slate-700 flex justify-between cursor-pointer">
                                <span><i class="fas fa-upload mr-2"></i> Importar JSON</span>
                                <input type="file" class="hidden" accept=".json" onchange="DataMgr.import(event)">
                            </label>
                        </div>
                    </div>
                    <div class="glass-card p-8 border-rose-100 bg-rose-50/30">
                        <h3 class="font-bold text-lg text-rose-700 mb-2">Reset</h3>
                        <button onclick="DataMgr.nuke()" class="w-full p-4 bg-rose-500 hover:bg-rose-600 text-white rounded-xl font-bold">APAGAR TUDO</button>
                        <button onclick="DataMgr.seed()" class="w-full mt-2 p-4 bg-[#006739] hover:bg-[#006739] text-white rounded-xl font-bold">Gerar Dados Teste</button>
                    </div>
                </div>

                <!-- Nova Seção de Reparo -->
                <div class="glass-card p-8 border-orange-100 bg-orange-50/30">
                    <h3 class="font-bold text-lg text-orange-700 mb-4">Reparo e Limpeza</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Delete by ID -->
                        <div>
                            <label class="block text-sm font-bold text-slate-500 mb-2">Apagar ID único</label>
                            <div class="flex gap-2">
                                <input type="number" id="config-del-id" placeholder="ID numérico..." class="flex-1 p-3 bg-white border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                                <button onclick="DataMgr.deleteById()" class="px-4 bg-orange-500 hover:bg-orange-600 text-white rounded-xl font-bold shadow-lg shadow-orange-200 transition-all hover:scale-105 active:scale-95" title="Apagar item específico">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <!-- Delete by Desc (Batch) -->
                        <div>
                            <label class="block text-sm font-bold text-slate-500 mb-2">Apagar por Descrição (Lote)</label>
                            <div class="flex gap-2">
                                <input type="text" id="config-del-desc" placeholder="Descrição exata..." class="flex-1 p-3 bg-white border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                                <button onclick="DataMgr.deleteByDesc()" class="px-4 bg-red-500 hover:bg-red-600 text-white rounded-xl font-bold shadow-lg shadow-red-200 transition-all hover:scale-105 active:scale-95" title="Apagar TODOS com esta descrição">
                                    <i class="fas fa-biohazard mr-2"></i> Limpar
                                </button>
                            </div>
                            <p class="text-xs text-orange-600 mt-2 font-semibold"><i class="fas fa-exclamation-triangle"></i> Atenção: Remove TODOS os registros começando com este texto.</p>
                        </div>
                    </div>
                </div>

                <!-- Nova Seção: Gestão de Categorias -->
                <div class="glass-card p-8 border-indigo-100 bg-indigo-50/30">
                    <h3 class="font-bold text-lg text-indigo-700 mb-4">Gestão de Categorias</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Formulário -->
                        <div class="md:col-span-1 space-y-3">
                            <input type="text" id="cat-manage-name" placeholder="Nome da Categoria" class="w-full p-3 bg-white border-2 border-indigo-100 rounded-xl focus:border-indigo-500 focus:outline-none">
                            <select id="cat-manage-type" class="w-full p-3 bg-white border-2 border-indigo-100 rounded-xl focus:border-indigo-500 focus:outline-none text-slate-600">
                                <option value="fixed">Despesa Fixa</option>
                                <option value="variable">Despesa Variável</option>
                                <option value="investment">Investimento / Patrimônio</option>
                                <option value="asset">Aquisição de Bens</option>
                            </select>
                            <div class="flex gap-2">
                                <input type="color" id="cat-manage-color" value="#6366f1" class="h-12 w-12 rounded-xl border-none cursor-pointer">
                                <button onclick="App.addCategoryFromConfig()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl shadow-lg shadow-indigo-200 transition">
                                    <i class="fas fa-plus mr-2"></i> Adicionar
                                </button>
                            </div>
                        </div>

                        <!-- Lista -->
                        <div class="md:col-span-2 bg-white rounded-xl p-4 shadow-sm max-h-60 overflow-y-auto custom-scroll" id="config-cat-list">
                            <!-- Injetado via JS -->
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div id="modal-overlay" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div id="modal-transaction" class="modal-content hidden bg-white w-full max-w-md rounded-[32px] p-8 shadow-2xl relative">
            <button onclick="Modal.close()" class="absolute top-6 right-6 w-10 h-10 rounded-xl bg-slate-100 hover:bg-rose-100 text-slate-600 hover:text-rose-600 transition flex items-center justify-center" title="Fechar">
                <i class="fas fa-times-circle text-xl"></i>
            </button>
            <h3 id="modal-title" class="text-xl font-black mb-6 text-slate-800">Nova Transação</h3>
            
            <div class="space-y-4">
                <input type="hidden" id="t-id">
                <input id="t-desc" type="text" placeholder="Descrição" class="w-full p-4 bg-slate-50 border-none rounded-xl font-medium">
                
                <div class="relative">
                    <input id="t-category" type="text" list="category-suggestions" placeholder="Digite a categoria (ex: Alimentação, Transporte...)" class="w-full p-4 bg-slate-50 border-none rounded-xl font-medium text-slate-600 focus:ring-2 focus:ring-[#8DC63F]">
                    <datalist id="category-suggestions"></datalist>
                    <div class="absolute right-4 top-4 text-xs text-slate-400 pointer-events-none">
                        <i class="fas fa-tag"></i>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <input id="t-amount" type="number" step="0.01" placeholder="Valor (R$)" class="w-full p-4 bg-slate-50 border-none rounded-xl font-medium">
                    <input id="t-date" type="date" class="w-full p-4 bg-slate-50 border-none rounded-xl font-medium text-slate-500">
                </div>

                <!-- Campo de Juros Opcional -->
                <div class="p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <div class="flex justify-between items-center mb-2">
                         <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="t-is-financing" class="w-4 h-4 accent-indigo-600 rounded mr-2" onchange="document.getElementById('interest-input-container').classList.toggle('hidden', !this.checked)">
                            <span class="text-xs font-bold text-slate-500">Tem juros embutidos?</span>
                         </label>
                    </div>
                    <div id="interest-input-container" class="hidden animate-fade-in-down">
                        <input id="t-interest" type="number" step="0.01" placeholder="Taxa de Juros Mensal (ex: 1.5)" class="w-full p-3 bg-white border border-indigo-100 rounded-lg font-bold text-indigo-600 placeholder-slate-300 focus:ring-2 focus:ring-indigo-500">
                        <p class="text-[10px] text-slate-400 mt-1 ml-1">Informe a taxa % mensal para que o conselheiro calcule vantagens de antecipação.</p>
                    </div>
                </div>

                <div id="recurrence-wrapper" class="p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <div class="flex items-center justify-between mb-2">
                        <label class="text-xs font-bold text-slate-400 uppercase">Repetir (Meses)</label>
                        <span class="text-[10px] text-slate-400 bg-white px-2 py-1 rounded">1 = Única</span>
                    </div>
                    <input id="t-repeat" type="number" min="1" value="1" class="w-full p-2 bg-white border border-slate-200 rounded-lg font-bold text-center">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button id="btn-type-in" onclick="Modal.setType('income')" class="p-3 rounded-xl font-bold text-sm bg-slate-100 text-slate-400 transition">Entrada</button>
                    <button id="btn-type-out" onclick="Modal.setType('expense')" class="p-3 rounded-xl font-bold text-sm bg-slate-100 text-slate-400 transition">Saída</button>
                </div>

                <div id="logic-dia-util" class="hidden p-3 bg-slate-50 rounded-xl flex items-center justify-between">
                    <span class="text-xs font-bold text-slate-600">Considerar 5º Dia Útil?</span>
                    <input type="checkbox" id="t-dia-util" class="w-5 h-5 accent-[#006739]">
                </div>

                <select id="t-method" onchange="Modal.toggleCardSelect()" class="w-full p-4 bg-slate-50 border-none rounded-xl font-medium text-slate-600">
                    <option value="money">Dinheiro / PIX / Débito</option>
                    <option value="credit">Cartão de Crédito</option>
                </select>

                <div id="card-select-wrapper" class="hidden">
                    <select id="t-card-id" class="w-full p-4 bg-slate-50 border-none rounded-xl font-medium text-slate-600"></select>
                </div>

                <div id="status-wrapper" class="flex gap-4 px-2">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="t-status" value="paid" checked class="w-4 h-4 text-[#006739]"> <span class="text-sm font-bold text-slate-600">Pago</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="t-status" value="pending" class="w-4 h-4 text-[#006739]"> <span class="text-sm font-bold text-slate-600">Pendente</span>
                    </label>
                </div>

                <button id="btn-save-transaction" onclick="App.saveTransaction()" class="w-full bg-[#006739] hover:bg-[#004d2c] text-white p-4 rounded-xl font-bold text-lg shadow-lg shadow-emerald-200 mt-4 transition">Salvar</button>
            </div>
        </div>

        <div id="modal-card" class="modal-content hidden bg-white w-full max-w-sm rounded-[32px] p-8 shadow-2xl relative">
            <button onclick="Modal.close()" class="absolute top-6 right-6 w-10 h-10 rounded-xl bg-slate-100 hover:bg-rose-100 text-slate-600 hover:text-rose-600 transition flex items-center justify-center" title="Fechar">
                <i class="fas fa-times-circle text-xl"></i>
            </button>
            <h3 class="text-xl font-black mb-6 text-slate-800">Novo Cartão</h3>
            <div class="space-y-4">
                <input id="c-name" type="text" placeholder="Nome" class="w-full p-4 bg-slate-50 border-none rounded-xl">
                <input id="c-limit" type="number" placeholder="Limite" class="w-full p-4 bg-slate-50 border-none rounded-xl">
                <div class="grid grid-cols-2 gap-4">
                    <input id="c-closing" type="number" placeholder="Dia Fech." class="p-4 bg-slate-50 border-none rounded-xl">
                    <input id="c-due" type="number" placeholder="Dia Venc." class="p-4 bg-slate-50 border-none rounded-xl">
                </div>
                <button onclick="App.addCard()" class="w-full bg-slate-900 text-white p-4 rounded-xl font-bold">Criar Cartão</button>
            </div>
        </div>

        <div id="modal-card-details" class="modal-content hidden bg-white w-full max-w-5xl rounded-[32px] p-8 shadow-2xl relative max-h-[90vh] overflow-hidden flex flex-col">
            <div class="mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-credit-card text-2xl text-[#006739]"></i>
                        <h3 id="card-details-title" class="text-2xl font-black text-slate-900">Cartão</h3>
                    </div>
                    
                    <button id="btn-pay-invoice" onclick="App.payCardInvoice()" class="bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white px-6 py-3 rounded-xl font-bold text-sm shadow-lg shadow-emerald-200 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-slate-300 disabled:to-slate-400 disabled:shadow-none">
                        <i class="fas fa-check-circle"></i> Pagar Fatura Completa
                    </button>
                    
                    <button onclick="Modal.close()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-rose-100 text-slate-600 hover:text-rose-600 transition flex items-center justify-center" title="Fechar">
                        <i class="fas fa-times-circle text-xl"></i>
                    </button>
                </div>
                <p id="card-details-filter" class="text-xs text-slate-500 font-bold uppercase tracking-wide"></p>
            </div>
            
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-br from-slate-50 to-slate-100 p-4 rounded-xl border-2 border-slate-200">
                    <p class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Total</p>
                    <h4 id="card-details-total" class="text-2xl font-black text-slate-900 mt-1">R$ 0,00</h4>
                </div>
                <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 p-4 rounded-xl border-2 border-emerald-200">
                    <p class="text-[10px] font-bold text-[#004d2c] uppercase tracking-widest flex items-center gap-1">
                        <i class="fas fa-check-square text-xs"></i> Conferido
                    </p>
                    <h4 id="card-details-checked" class="text-2xl font-black text-[#004d2c] mt-1">R$ 0,00</h4>
                </div>
                <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 p-4 rounded-xl border-2 border-emerald-200">
                    <p class="text-[10px] font-bold text-emerald-700 uppercase tracking-widest">Pago</p>
                    <h4 id="card-details-paid" class="text-2xl font-black text-emerald-700 mt-1">R$ 0,00</h4>
                </div>
                <div class="bg-gradient-to-br from-amber-50 to-amber-100 p-4 rounded-xl border-2 border-amber-200">
                    <p class="text-[10px] font-bold text-amber-700 uppercase tracking-widest">Pendente</p>
                    <h4 id="card-details-pending" class="text-2xl font-black text-amber-700 mt-1">R$ 0,00</h4>
                </div>
            </div>
            
            <div class="flex gap-3 mb-4">
                <button onclick="App.checkAllInvoice(true)" class="flex-1 bg-emerald-100 hover:bg-emerald-200 text-[#004d2c] px-4 py-2 rounded-lg font-bold text-sm transition flex items-center justify-center gap-2">
                    <i class="fas fa-check-double"></i> Marcar Todos
                </button>
                <button onclick="App.checkAllInvoice(false)" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded-lg font-bold text-sm transition flex items-center justify-center gap-2">
                    <i class="fas fa-times"></i> Desmarcar Todos
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto custom-scroll">
                <table class="w-full text-left text-sm">
                    <thead class="bg-gradient-to-r from-slate-700 to-slate-800 text-white sticky top-0 z-10">
                        <tr>
                            <th class="p-3 font-black uppercase text-[10px] tracking-wider text-center">ID</th>
                            <th class="p-3 font-black uppercase text-[10px] tracking-wider text-center">OK?</th>
                            <th class="p-3 font-black uppercase text-[10px] tracking-wider">Data Venc.</th>
                            <th class="p-3 font-black uppercase text-[10px] tracking-wider">Descrição</th>
                            <th class="p-3 font-black uppercase text-[10px] tracking-wider">Categoria</th>
                            <th class="p-3 font-black uppercase text-[10px] tracking-wider">Status</th>
                            <th class="p-3 font-black uppercase text-[10px] tracking-wider text-right">Valor</th>
                            <th class="p-3 font-black uppercase text-[10px] tracking-wider text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="card-details-table"></tbody>
                </table>
            </div>
        </div>

        <div id="modal-calibrate" class="modal-content hidden bg-white w-full max-w-md rounded-[32px] p-8 shadow-2xl relative animate-fade-in-up">
            <button onclick="Modal.close()" class="absolute top-6 right-6 w-10 h-10 rounded-xl bg-slate-100 hover:bg-rose-100 text-slate-600 hover:text-rose-600 transition flex items-center justify-center" title="Fechar">
                <i class="fas fa-times-circle text-xl"></i>
            </button>
            <h3 class="text-xl font-black mb-2 text-slate-800 text-indigo-700 flex items-center gap-2">
                <i class="fas fa-calculator"></i> Calibrar Juros
            </h3>
            <p class="text-sm text-slate-500 mb-6 leading-relaxed">Se você abrisse o app do banco hoje e antecipasse todas as parcelas restantes desta compra, qual seria o valor total cobrado?</p>
            
            <div class="space-y-4">
                <input type="hidden" id="calib-name">
                <input type="hidden" id="calib-total">
                <input type="hidden" id="calib-count">
                
                <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-indigo-400 uppercase">Dívida Total Futura</span>
                        <span class="text-xs font-bold text-indigo-400 uppercase bg-white px-2 py-1 rounded-lg shadow-sm" id="calib-display-count">0x</span>
                    </div>
                    <p id="calib-display-total" class="text-2xl font-black text-indigo-900 mt-1">R$ 0,00</p>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1 ml-1">Valor para Quitação Hoje</label>
                    <input id="calib-value" type="number" step="0.01" placeholder="Ex: 1540.50" class="w-full p-4 bg-slate-50 border-2 border-transparent focus:border-indigo-500 focus:bg-white rounded-xl font-bold text-lg text-slate-800 transition outline-none">
                </div>
                
                <button onclick="App.runCalibration()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-xl font-bold transition shadow-lg shadow-indigo-200 flex items-center justify-center gap-2">
                    <i class="fas fa-save"></i> Calcular & Salvar Taxa
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</body>
</html>

